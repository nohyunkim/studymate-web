<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¤í„°ë”” ì°¾ê¸° - ìŠ¤í„°ë”” ë©”ì´íŠ¸</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>

    <header>
        <div class="nav-container">
            <a href="{{ url_for('index') }}" class="logo">STUDY MATE</a>

            <nav class="nav-menu">
                <a href="{{ url_for('index') }}">í™ˆ</a>
                <a href="{{ url_for('study') }}">ìŠ¤í„°ë”” ì°¾ê¸°</a>

                {% if user_nickname %}
                <div class="user-dropdown">
                    <button class="user-btn" onclick="toggleDropdown()">
                        {{ user_nickname }} <span class="arrow">â–¾</span>
                    </button>

                    <div class="dropdown-menu" id="dropdownMenu">
                        <a href="{{ url_for('mypage') }}">ë§ˆì´í˜ì´ì§€</a>
                        <a href="{{ url_for('my_posts') }}">ë‚´ê°€ ì“´ ê¸€</a>
                        <hr>
                        <a href="{{ url_for('logout') }}">ë¡œê·¸ì•„ì›ƒ</a>
                    </div>
                </div>
                {% else %}
                    <a href="{{ url_for('login') }}">ë¡œê·¸ì¸</a>
                {% endif %}
            </nav>
        </div>
    </header>


    <main>
        <section style="text-align: center;">
            <h2 class="section-title">ğŸ” ì›í•˜ëŠ” ìŠ¤í„°ë””ë¥¼ ì°¾ì•„ë³´ì„¸ìš”</h2>
            
            <form action="{{ url_for('study') }}" method="GET" class="search-box">
                <input type="text" name="keyword" placeholder="ìŠ¤í„°ë”” ì œëª©ì„ ê²€ìƒ‰í•´ë³´ì„¸ìš”" 
                    value="{{ keyword if keyword else '' }}" style="margin-bottom: 0;">
                    
                <button type="submit" class="primary-btn" style="width: auto; padding: 12px 20px;">ê²€ìƒ‰</button>

                {% if user_nickname %}
                    <a href="{{ url_for('studywrite') }}" class="write-btn">ëª¨ì§‘í•˜ê¸° âœï¸</a>
                {% else %}
                    <a href="{{ url_for('login') }}" class="write-btn">ë¡œê·¸ì¸ í›„ ëª¨ì§‘í•˜ê¸° âœï¸</a>
                {% endif %}
            </form>
        </section>

        <section>
            <div class="study-list">
                
                {% for post in pagination.items %}
                <a href="{{ url_for('study_detail', study_id=post.id) }}" style="color: inherit;">
                    <article class="card">
                        <h3>{{ post.title }}</h3>

                        <p style="color: #666; font-size: 14px; margin-bottom: 10px;">
                            {% if post.content|length > 50 %}
                                {{ post.content[:50] }}...
                            {% else %}
                                {{ post.content }}
                            {% endif %}
                        </p>

                        <div style="font-size: 12px; color: #888; margin-bottom: 10px;">
                            <span>ğŸ‘‘ {{ post.writer }}</span> |
                            <span>ğŸ‘¥ {{ post.member_count }}ëª… ëª¨ì§‘</span>
                        </div>

                        <span class="tag">{{ post.category }}</span>
                    </article>
                </a>
                {% endfor %}

                {% if pagination.total == 0 %}
                    <p class="empty-message">
                        ì•„ì§ ë“±ë¡ëœ ìŠ¤í„°ë””ê°€ ì—†ìŠµë‹ˆë‹¤. ì²« ë²ˆì§¸ ì£¼ì¸ê³µì´ ë˜ì–´ë³´ì„¸ìš”! ğŸ˜
                    </p>
                {% endif %}
            </div>

            {% if pagination.total > 0 %}
            <div class="pagination">
                {% if pagination.has_prev %}
                    <a href="?page={{ pagination.prev_num }}">&lt;</a>
                {% endif %}

                {% for page_num in pagination.iter_pages() %}
                    {% if page_num %}
                        {% if page_num == pagination.page %}
                            <a href="#" class="active">{{ page_num }}</a> {% else %}
                            <a href="?page={{ page_num }}">{{ page_num }}</a>
                        {% endif %}
                    {% else %}
                        <span>...</span>
                    {% endif %}
                {% endfor %}

                {% if pagination.has_next %}
                    <a href="?page={{ pagination.next_num }}">&gt;</a>
                {% endif %}
            </div>
            {% endif %}

        </section>
    </main>

    <footer>
        <p>Â© 2026 Study Mate. Designed by ê¹€ë…¸í˜„</p>
    </footer>

    <script>
        function toggleDropdown() {
            const menu = document.getElementById('dropdownMenu');
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        }

        // ë°”ê¹¥ í´ë¦­ ì‹œ ë‹«ê¸°
        document.addEventListener('click', function (e) {
            const dropdown = document.querySelector('.user-dropdown');
            const menu = document.getElementById('dropdownMenu');

            if (dropdown && !dropdown.contains(e.target)) {
                menu.style.display = 'none';
            }
        });
    </script>

</body>
</html>